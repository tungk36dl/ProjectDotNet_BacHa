@using BacHa.Helper
@model BacHa.Models.Entity.Product

@{
    ViewData["Title"] = Model.Name;
}

<div class="container-fluid">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a asp-controller="Home" asp-action="Index">
                    <i class="fas fa-home"></i> Trang chủ
                </a>
            </li>
            <li class="breadcrumb-item">
                <a asp-action="Shop">
                    <i class="fas fa-store"></i> Cửa hàng
                </a>
            </li>
            @if (Model.Category != null)
            {
                <li class="breadcrumb-item">
                    <a asp-action="Shop" asp-route-CategoryId="@Model.Category.Id">
                        @Model.Category.Name
                    </a>
                </li>
            }
            <li class="breadcrumb-item active" aria-current="page">@Model.Name</li>
        </ol>
    </nav>

    <div class="row">
        <!-- Product Images -->
        <div class="col-lg-6 mb-4">
            <div class="card">
                <div class="card-body p-0">
                    <div class="product-image-container">
                        @Html.ProductImageResponsive(Model.ImageUrl, Model.Name)
                    </div>
                </div>
            </div>
        </div>

        <!-- Product Information -->
        <div class="col-lg-6">
            <div class="card h-100">
                <div class="card-body">
                    <h1 class="card-title display-6 mb-3">@Model.Name</h1>
                    
                    @if (Model.Category != null)
                    {
                        <div class="mb-3">
                            <span class="badge bg-primary fs-6">@Model.Category.Name</span>
                        </div>
                    }

                    <!-- Price -->
                    <div class="mb-4">
                        <h2 class="text-success mb-0">
                            @Html.FormatVNDForProduct(Model.Price)
                        </h2>
                    </div>

                    <!-- Stock Status -->
                    <div class="mb-4">
                        @if (Model.Stock > 0)
                        {
                            @if (Model.Stock <= 10)
                            {
                                <div class="alert alert-warning d-flex align-items-center" role="alert">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    <div>
                                        <strong>Chỉ còn @Model.Stock sản phẩm!</strong> Đặt hàng ngay để không bỏ lỡ.
                                    </div>
                                </div>
                            }
                            else
                            {
                                <div class="alert alert-success d-flex align-items-center" role="alert">
                                    <i class="fas fa-check-circle me-2"></i>
                                    <div>
                                        <strong>Còn hàng</strong> - @Model.Stock sản phẩm có sẵn
                                    </div>
                                </div>
                            }
                        }
                        else
                        {
                            <div class="alert alert-danger d-flex align-items-center" role="alert">
                                <i class="fas fa-times-circle me-2"></i>
                                <div>
                                    <strong>Hết hàng</strong> - Sản phẩm tạm thời không có sẵn
                                </div>
                            </div>
                        }
                    </div>

                    <!-- Description -->
                    @if (!string.IsNullOrEmpty(Model.Description))
                    {
                        <div class="mb-4">
                            <h5>Mô tả sản phẩm</h5>
                            <p class="text-muted">@Model.Description</p>
                        </div>
                    }

                    <!-- Action Buttons -->
                    <div class="d-grid gap-2 d-md-flex">
                        @if (Model.Stock > 0)
                        {
                            <button class="btn btn-success btn-lg flex-fill" onclick="addToCart('@Model.Id')">
                                <i class="fas fa-shopping-cart me-2"></i>
                                Thêm vào giỏ hàng
                            </button>
                            <button class="btn btn-primary btn-lg flex-fill" onclick="buyNow('@Model.Id')">
                                <i class="fas fa-bolt me-2"></i>
                                Mua ngay
                            </button>
                        }
                        else
                        {
                            <button class="btn btn-secondary btn-lg flex-fill" disabled>
                                <i class="fas fa-times me-2"></i>
                                Hết hàng
                            </button>
                        }
                    </div>

                    <!-- Additional Info -->
                    <div class="mt-4 pt-4 border-top">
                        <div class="row text-center">
                            <div class="col-4">
                                <i class="fas fa-shipping-fast fa-2x text-primary mb-2"></i>
                                <h6>Giao hàng nhanh</h6>
                                <small class="text-muted">1-2 ngày</small>
                            </div>
                            <div class="col-4">
                                <i class="fas fa-undo fa-2x text-success mb-2"></i>
                                <h6>Đổi trả dễ dàng</h6>
                                <small class="text-muted">7 ngày</small>
                            </div>
                            <div class="col-4">
                                <i class="fas fa-shield-alt fa-2x text-info mb-2"></i>
                                <h6>Bảo hành chính hãng</h6>
                                <small class="text-muted">12 tháng</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Details Tabs -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <ul class="nav nav-tabs card-header-tabs" id="productTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="details-tab" data-bs-toggle="tab" data-bs-target="#details" type="button" role="tab">
                                <i class="fas fa-info-circle me-2"></i>Chi tiết sản phẩm
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="specifications-tab" data-bs-toggle="tab" data-bs-target="#specifications" type="button" role="tab">
                                <i class="fas fa-cogs me-2"></i>Thông số kỹ thuật
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews" type="button" role="tab">
                                <i class="fas fa-star me-2"></i>Đánh giá (0)
                            </button>
                        </li>
                    </ul>
                </div>
                <div class="card-body">
                    <div class="tab-content" id="productTabsContent">
                        <!-- Details Tab -->
                        <div class="tab-pane fade show active" id="details" role="tabpanel">
                            <div class="row">
                                <div class="col-md-6">
                                    <h5>Thông tin cơ bản</h5>
                                    <table class="table table-borderless">
                                        <tr>
                                            <td><strong>Tên sản phẩm:</strong></td>
                                            <td>@Model.Name</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Thể loại:</strong></td>
                                            <td>@(Model.Category?.Name ?? "-")</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Giá:</strong></td>
                                            <td class="text-success fw-bold">@Html.FormatVNDForProduct(Model.Price)</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Tồn kho:</strong></td>
                                            <td>@Model.Stock sản phẩm</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Trạng thái:</strong></td>
                                            <td>
                                                @if (Model.IsActive)
                                                {
                                                    <span class="badge bg-success">Đang bán</span>
                                                }
                                                else
                                                {
                                                    <span class="badge bg-secondary">Ngừng bán</span>
                                                }
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="col-md-6">
                                    <h5>Thông tin bổ sung</h5>
                                    <table class="table table-borderless">
                                        <tr>
                                            <td><strong>Ngày tạo:</strong></td>
                                            <td>@Model.CreatedAt.ToString("dd/MM/yyyy HH:mm")</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Cập nhật lần cuối:</strong></td>
                                            <td>@(Model.UpdatedAt?.ToString("dd/MM/yyyy HH:mm") ?? "-")</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Specifications Tab -->
                        <div class="tab-pane fade" id="specifications" role="tabpanel">
                            <div class="text-center py-5">
                                <i class="fas fa-cogs fa-3x text-muted mb-3"></i>
                                <h5 class="text-muted">Thông số kỹ thuật</h5>
                                <p class="text-muted">Thông tin chi tiết về thông số kỹ thuật sẽ được cập nhật sớm.</p>
                            </div>
                        </div>

                        <!-- Reviews Tab -->
                        <div class="tab-pane fade" id="reviews" role="tabpanel">
                            <div class="text-center py-5">
                                <i class="fas fa-star fa-3x text-muted mb-3"></i>
                                <h5 class="text-muted">Đánh giá sản phẩm</h5>
                                <p class="text-muted">Chưa có đánh giá nào cho sản phẩm này. Hãy là người đầu tiên đánh giá!</p>
                                <button class="btn btn-primary" disabled>
                                    <i class="fas fa-star me-2"></i>Viết đánh giá
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Related Products -->
    @if (Model.Category != null)
    {
        <div class="row mt-5">
            <div class="col-12">
                <h3 class="mb-4">
                    <i class="fas fa-th-large me-2"></i>Sản phẩm liên quan
                </h3>
                <div id="relatedProducts" class="row">
                    <!-- Related products will be loaded here via AJAX -->
                </div>
            </div>
        </div>
    }
</div>

@section Scripts {
    <script>
        // Add to cart function
        function addToCart(productId) {
            // TODO: Implement add to cart functionality
            alert('Chức năng thêm vào giỏ hàng sẽ được triển khai sớm!');
        }

        // Buy now function
        function buyNow(productId) {
            // TODO: Implement buy now functionality
            alert('Chức năng mua ngay sẽ được triển khai sớm!');
        }

        // Load related products
        $(document).ready(function() {
            @if (Model.Category != null)
            {
                <text>
                loadRelatedProducts('@Model.Category.Id', '@Model.Id');
                </text>
            }
        });

        function loadRelatedProducts(categoryId, excludeProductId) {
            $.get('@Url.Action("GetProductsByCategory", "Products")', { categoryId: categoryId })
                .done(function(response) {
                    if (response.success && response.data) {
                        var products = response.data.filter(p => p.id !== excludeProductId).slice(0, 4);
                        var html = '';
                        
                        products.forEach(function(product) {
                            html += `
                                <div class="col-lg-3 col-md-6 mb-4">
                                    <div class="card h-100 product-card shadow-sm">
                                        <div class="position-relative">
                                            <img src="${product.imageUrl || '/images/placeholder.svg'}" 
                                                 alt="${product.name}" 
                                                 class="card-img-top" 
                                                 style="height: 200px; object-fit: cover;">
                                        </div>
                                        <div class="card-body d-flex flex-column">
                                            <h6 class="card-title text-truncate">${product.name}</h6>
                                            <div class="mt-auto">
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <span class="text-success fw-bold">${formatVND(product.price)}</span>
                                                </div>
                                                <a href="/Products/ProductDetails/${product.id}" 
                                                   class="btn btn-outline-primary btn-sm w-100">
                                                    <i class="fas fa-eye me-1"></i>Xem chi tiết
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                        
                        $('#relatedProducts').html(html);
                    }
                })
                .fail(function() {
                    $('#relatedProducts').html('<div class="col-12 text-center text-muted">Không thể tải sản phẩm liên quan.</div>');
                });
        }

        // Format VND currency
        function formatVND(amount) {
            return new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND'
            }).format(amount);
        }
    </script>
}

@* @section Styles {
    <style>
        .product-image-container {
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
        }
        
        .product-image-container img {
            max-height: 400px;
            width: 100%;
            object-fit: contain;
        }
        
        .product-card {
            transition: all 0.3s ease;
            border: none;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        }
        
        .breadcrumb {
            background: none;
            padding: 0;
        }
        
        .breadcrumb-item a {
            color: #007bff;
            text-decoration: none;
        }
        
        .breadcrumb-item a:hover {
            text-decoration: underline;
        }
        
        .nav-tabs .nav-link {
            border: none;
            color: #6c757d;
        }
        
        .nav-tabs .nav-link.active {
            color: #007bff;
            border-bottom: 2px solid #007bff;
        }
    </style>
} *@
